server {
    
    # base server config
    listen <%= access_port %>;
    server_name <%= server_name %>;

    # log config
    access_log /var/log/nginx/access.log;
    error_log /var/log/nginx/error.log;

    # define upstream for our app worker
    upstream workers {
        <% Integer(num_workers).times do |i| %>
            server http://localhost:500<%= i %>;
        <% end %>
    }
    
    # serve /static directly out of the public root
    location /static {
        root <%= public_root %>/static ;
    }

    # pass all other traffic to the workers
    location / {
        proxy_pass http://workers;
    }
    
}